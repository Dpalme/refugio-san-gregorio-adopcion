<!DOCTYPE html>
<html lang="en">

<head>

  <!-- 
    This is the main Handlebars template for the site 
    - When the user visits the homepage or submits a choice the app calls the endpoints in server.js
    - The server script passes data in here and the Handlebars code builds it into the HTML page
  -->

  <meta charset="utf-8" />
  <link rel="icon" href="https://glitch.com/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{{seo.title}}</title>

  <!-- Meta tags for SEO and social sharing -->
  <link rel="canonical" href="{{seo.url}}">
  <meta name="description" content="{{seo.description}}">
  <meta property="og:title" content="{{seo.title}}">
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{seo.url}}">
  <meta property="og:description" content="{{seo.description}}">
  <meta property="og:image" content="{{seo.image}}">
  <meta name="twitter:card" content="summary">

  <!-- Import the webpage's stylesheet -->
  <link href="https://dpalmer.in/Peoria/css/normalize.css" rel="stylesheet">
  <link href="https://dpalmer.in/Peoria/css/peoria-0-6-0.css" rel="stylesheet">

  <!-- Show choice chart on poll submission -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="text/javascript">
    /*
    The chart uses chart.js - try tweaking the config!
    https://www.chartjs.org/docs/3.0.2/charts/doughnut.html
    
    We pass the choices and picks arrays from the page when the server script returns them
    */
    function showChart(choices, picks) {
      
      // Get the page element to show the chart inside
      var ctx = document.getElementById('myChart');
      
      // Set up the chart colors
      var colors = ["#05DA84", "#E6E656", "#E5AED6"];
      var border = "#ffffff";
      
      // Make sure we have some votes–if not show an empty chart
      if(picks.reduce((a, b) => a + b, 0)<1) {
        picks=["1e-10"]; // use a near zero value so that the doughnut displays
        choices=["No votes! Reload and vote again."];
        colors=["#00000000"]; // we'll show an empty doughnut shape
        border=["#000000"];
      }
      
      // Build the chart in the page element
      var myLineChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: choices,
          datasets: [{
            data: picks,
            backgroundColor: colors,
            borderColor: border,
            fill: true,
            hoverOffset: 12,
            cutout: "60%"
          }]
        },
        options: {
          plugins: {
            legend: {
              display: true,
              position: "bottom",
              labels: {
                padding: 24
              }
            }
          },
          layout: {
            padding: 24
          }
        }
      });
    }
  </script>
  <style>
    .align-center {
      align-self: center;
    }
    label {
      line-height: 1.25rem;
      margin-top: 16px;
    }
  </style>
</head>

<body>
  <section>
    <div class="content" role="main">
      <!-- This is the start of content for our page -->
      <h1>Manejo Refugio San Gregorio</h1>
      <p class="mb-lg">
        Ver lo perros que tenemos en adopcióny agregar nuevos.
      </p>
      {{#if error}}
      <p class="error">
        {{error}}
      </p>
      {{else}}
      <!-- Server returns a flag when the user has submitted a choice and we show the results -->
      <div class="grid relative">
        <div class="col-6" id="add">
          <h2 class="mb-sm">Agregar Perro</h2>
          <div class="poll-form">
            <!-- Call the server post endpoint when the user submits an option in the poll -->
            <form method="post" action="/">
              <!-- The server script returns the list of language options to offer in the poll -->
              <label for="imgFile">Imagen</label>
              <input type="file" id="imgFile" name="imgBlob" onchange="processImage()" required />
              <input type="text" id="imgB64" name="img" class="d-none" required />
              <label for="dogName">Nombre</label>
              <input type="text" id="dogName" name="nombre" required />
              <label for="dogAge">Edad (meses)</label>
              <input type="number" id="dogAge" name="edad" required />
              <label for="dogSex">Sexo</label>
              <select id="dogSex" name="sexo">
                <option value="Macho">Macho</option>
                <option value="Hembra">Hembra</option>
              </select>
              <button type="submit" class="rounded-lg px-lg mt-md">Enviar</button>
            </form>
          </div>  
        </div>
        <div id="dogs" class="col-6">
          <h2>Perros</h2>
          <div class="poll-results">
            <p class="mb-md">Estos son los perros registrados en adopción</p>
            <div class="grid">
              <p class="col-t bold">Foto</p>
              <p class="col-t bold">Nombre</p>
              <p class="col-t bold">Edad/Sexo</p>
              {{#each dogs }}
              <img class="col-t" src="data:image/png;base64,{{this.img}}">
              <p class="col-t align-center">{{this.nombre}}</p>
              <p class="col-t align-center">{{this.edad}}/{{this.sexo}}</p>
              {{/each}}
            </div>
          </div>
        </div>
      </div>
      {{/if}}
    </div>
  </section>
  <script>
    function processImage() {
      var file = document.getElementById('imgFile')['files'][0];
      var reader = new FileReader();
      reader.onload = function () {
        document.getElementById('imgB64').value = reader.result.replace("data:", "").replace(/^.+,/, "");
      }  
      reader.readAsDataURL(file);
    }
  </script>
</body>

</html>
